function ASA = ASAUpdate(ASA,correctresponse)%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% accelerated stocahstic approximation;  info: help ASASetup. - M.H. 2014%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%ASA.ntrial = ASA.ntrial+1;ASA.response(ASA.ntrial) = correctresponse;                                % check if trendif correctresponse==1,                    ASA.down=[ASA.down 1];    ASA.up=[ASA.up 0];    if ASA.ntrial>1 && ASA.down(ASA.ntrial-1)==1,        ASA.trend=[ASA.trend 1];    else        ASA.trend=[ASA.trend 0];    endelseif correctresponse==0,    ASA.down=[ASA.down 0];    ASA.up=[ASA.up 1];    if ASA.ntrial>1 && ASA.up(ASA.ntrial-1)==1,        ASA.trend=[ASA.trend 1];    else        ASA.trend=[ASA.trend 0];    endend                                 % check if trend shiftif ASA.ntrial>1 && ASA.trend(ASA.ntrial)==0 && ASA.trend(ASA.ntrial-1)==1,    ASA.trendbreuk=[ASA.trendbreuk 1];else    ASA.trendbreuk=[ASA.trendbreuk 0];end    ASA.mshift=ASA.mshift+ASA.trendbreuk(end);    if ASA.ntrial<3                 % determine stepsize     Astep=(ASA.stepcon/ASA.ntrial)*(correctresponse-ASA.phi);    ASA.step=[ASA.step Astep];elseif ASA.ntrial>=3,    Astep=(ASA.stepcon/(2+ASA.mshift))*(correctresponse-ASA.phi);    ASA.step=[ASA.step Astep];end                                % update stimulus levelstimX=ASA.X(end)-ASA.step(end);ASA.X=[ASA.X stimX];if ASA.static==0,             % DYNAMIC terminate criterion:    Astepmax=(ASA.stepcon/(2+ASA.mshift))*(-ASA.phi);if abs(Astepmax)<ASA.ts,       ASA.keepgoing=0;else    ASA.keepgoing=1;end                             % if static, FIXED stopping criterion      elseif ASA.static==1,    if ASA.ntrial>ASA.ts,        ASA.keepgoing=0;    else        ASA.keepgoing=1;    endend